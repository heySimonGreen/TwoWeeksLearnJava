[toc]

# 11月24日培训

## 任务：使用sql monitor 监控在整个门诊就诊过程sql运行情况。

## 一、点击当日挂号进行挂号操作

### 情况一：老客户

#### 1 挂号 -> 当日挂号 分两种，一种第一次来，新增

```
挂号 -> 当日挂号

----------------------------------
Timestamp: 09:08:29.146
SELECT "CLINIC_FOR_REGIST"."CLINIC_LABEL", "CLINIC_FOR_REGIST"."TIME_DESC", "CLINIC_FOR_REGIST"."REGISTRATION_LIMITS", 
"CLINIC_FOR_REGIST"."APPOINTMENT_LIMITS", "CLINIC_FOR_REGIST"."REGIST_PRICE", 0, "CLINIC_INDEX"."CLINIC_DEPT", 
"CLINIC_INDEX"."DOCTOR", "CLINIC_INDEX"."DOCTOR_TITLE", "CLINIC_INDEX"."CLINIC_TYPE", "CLINIC_FOR_REGIST"."CURRENT_NO", '号', 
'', 0, "CLINIC_INDEX"."INPUT_CODE", "DEPT_DICT"."POSITION", "CLINIC_INDEX"."CLINIC_POSITION", 0 as aa, 
"CLINIC_INDEX"."CLINIC_INDEX" FROM "CLINIC_FOR_REGIST", "CLINIC_INDEX", "DEPT_DICT" WHERE ( "CLINIC_FOR_REGIST"."CLINIC_LABEL" 
= "CLINIC_INDEX"."CLINIC_LABEL" ) and ( "CLINIC_INDEX"."CLINIC_DEPT" = "DEPT_DICT"."DEPT_CODE" ) and ( 
CLINIC_FOR_REGIST.CLINIC_DATE = :day1 )
:day1 = '2021/11/25'
----------------------------------

Timestamp: 09:08:29.186
select region_code,region_name from area_to_dict where parent_code=:region_code
:region_code = '100000'
---------------------------------

Timestamp: 09:08:29.297
SELECT DISTINCT "CLINIC_TYPE_SETTING"."CLINIC_TYPE", "CLINIC_TYPE_SETTING"."SERIAL_NO" FROM "CLINIC_TYPE_SETTING"
号类

----------------------------------
Timestamp: 09:08:29.342
SELECT SPECIAL_REGIST_PRICE.CLINIC_TYPE, SPECIAL_REGIST_PRICE.CHARGE_TYPE, SPECIAL_REGIST_PRICE.PRICE FROM SPECIAL_REGIST_PRICE
特殊挂号费价表
----------------------------------
Timestamp: 09:08:29.390
SELECT CHARGE_TYPE_DICT.CHARGE_TYPE_CODE, CHARGE_TYPE_DICT.CHARGE_TYPE_NAME, CHARGE_TYPE_DICT.SERIAL_NO, CLINIC_PRICE.PRICE 
FROM CHARGE_TYPE_DICT, CLINIC_PRICE WHERE ( charge_type_dict.charge_type_name = clinic_price.charge_type (+))
费别字典
----------------------------------
Timestamp: 09:08:29.420
SELECT  "IDENTITY_DICT"."IDENTITY_CODE" ,           "IDENTITY_DICT"."IDENTITY_NAME" ,           "IDENTITY_DICT"."SERIAL_NO"     
FROM "IDENTITY_DICT"学生、教师。。。
----------------------------------
Timestamp: 09:08:29.451
SELECT INSURANCE_TYPE_DICT.INSURANCE_TYPE_CODE, INSURANCE_TYPE_DICT.INSURANCE_TYPE_NAME, INSURANCE_TYPE_DICT.SERIAL_NO FROM 
INSURANCE_TYPE_DICT
----------------------------------
Timestamp: 09:08:29.481
SELECT  "SEX_DICT"."SEX_CODE" ,           "SEX_DICT"."SEX_NAME" ,           "SEX_DICT"."SERIAL_NO"     FROM "SEX_DICT"
----------------------------------
Timestamp: 09:08:29.511
select sysdate from dual

```

其中注意到有段sql

```
Timestamp: 09:08:29.542
SELECT "CLINIC_FOR_REGIST"."CLINIC_LABEL", "CLINIC_FOR_REGIST"."TIME_DESC", "CLINIC_FOR_REGIST"."REGISTRATION_LIMITS", 
"CLINIC_FOR_REGIST"."APPOINTMENT_LIMITS", "CLINIC_FOR_REGIST"."REGIST_PRICE", 0, "CLINIC_INDEX"."CLINIC_DEPT", 
"CLINIC_INDEX"."DOCTOR", "CLINIC_INDEX"."DOCTOR_TITLE", "CLINIC_INDEX"."CLINIC_TYPE", "CLINIC_FOR_REGIST"."CURRENT_NO", '号', 
'', 0, "CLINIC_INDEX"."INPUT_CODE", "DEPT_DICT"."POSITION", "CLINIC_INDEX"."CLINIC_POSITION", 0 as aa, 
"CLINIC_INDEX"."CLINIC_INDEX" FROM "CLINIC_FOR_REGIST", "CLINIC_INDEX", "DEPT_DICT" WHERE ( "CLINIC_FOR_REGIST"."CLINIC_LABEL" 
= "CLINIC_INDEX"."CLINIC_LABEL" ) and ( "CLINIC_INDEX"."CLINIC_DEPT" = "DEPT_DICT"."DEPT_CODE" ) and ( 
CLINIC_FOR_REGIST.CLINIC_DATE = :day1 )
:day1 = '2021/11/25'
```

这时查询当日挂号医生。

##### 号类设置表

![image-20211207171807792](C:\Users\11839\AppData\Roaming\Typora\typora-user-images\image-20211207171807792.png)

![image-20211207170224096](C:\Users\11839\AppData\Roaming\Typora\typora-user-images\image-20211207170224096.png)

##### 特殊挂号费价表

![image-20211207171732115](C:\Users\11839\AppData\Roaming\Typora\typora-user-images\image-20211207171732115.png)

![image-20211207170910170](C:\Users\11839\AppData\Roaming\Typora\typora-user-images\image-20211207170910170.png)

##### 费别字典

![](C:\Users\11839\AppData\Roaming\Typora\typora-user-images\image-20211207171400180.png)

![image-20211207171702958](C:\Users\11839\AppData\Roaming\Typora\typora-user-images\image-20211207171702958.png)

#### 2 填写病人信息后点击 挂号 

```
挂号界面点击挂号 -> 输入病人id
**************************************************
----------------------------------
Timestamp: 09:20:33.164
select sysdate from dual
----------------------------------
Timestamp: 09:20:33.202
select registration_limits , appointment_limits , current_no , registration_num from clinic_for_regist where clinic_date =:1 
and clinic_label =:2 and time_desc =:3
:1 = '2021/11/25'
:2 = '产科-刘伶俐'
:3 = '白天'
----------------------------------
Timestamp: 09:20:33.286
select count ( *) from unit_in_contract where unit_name =:1
:1 = ''
id生成，如果查找为空就会生成id
----------------------------------

Timestamp: 09:20:33.321
select a.unit_code from unit_in_contract a where a.unit_name =:1
:1 = ''

Timestamp: 09:20:33.630
select count ( *) from pat_master_index where patient_id =:1
:1 = 'M0000560'
----------------------------------
Timestamp: 09:20:33.669
select patient_id from pat_master_index where patient_id =:1
:1 = 'M0000560'
----------------------------------
Timestamp: 09:20:33.711
select sysdate from dual
----------------------------------
Timestamp: 09:20:33.742
SELECT TO_CHAR ( SYSDATE , 'yyyymmdd' ) || LPAD ( TO_CHAR ( OUTPBILL.SQ_RCPT_NUMBER.NEXTVAL ) , 6 , '0' ) , 
OUTPBILL.SQ_RCPT_NUMBER.NEXTVAL FROM DUAL
----------------------------------
Timestamp: 09:20:33.757
select count ( *) from clinic_master where visit_date =trunc ( sysdate ) and visit_no =:1
:1 = 394
----------------------------------
Timestamp: 09:20:33.814
select clinic_type , clinic_position , clinic_dept , doctor from CLINIC_INDEX where CLINIC_LABEL =:1
:1 = '产科-刘伶俐'
----------------------------------
Timestamp: 09:20:33.853
select id_no , name from staff_dict where user_name =:1
:1 = 'LLL2'
----------------------------------
Timestamp: 09:20:33.891
select price_item from clinic_type_setting where charge_item =:1 and clinic_type =:2
:1 = '诊察费'
:2 = '普通号'
----------------------------------
Timestamp: 09:20:33.938
select item_class , item_spec , price from current_price_list where item_code =:1
:1 = 'def00000126'
----------------------------------
Timestamp: 09:20:33.975
select PRICE_COEFF_NUMERATOR , PRICE_COEFF_DENOMINATOR from CHARGE_PRICE_SCHEDULE where charge_type =:1
:1 = '自费'
----------------------------------
Timestamp: 09:20:34.014
select charge_special_indicator from CHARGE_PRICE_SCHEDULE where charge_type =:1
:1 = '自费'
----------------------------------
Timestamp: 09:20:34.053
SELECT proportion_numerator , proportion_denominator , free_limit FROM charge_special_except_dict WHERE charge_type =:1 AND 
item_class =:2 AND ( item_code =:3 OR item_code ='*' ) AND ( item_spec =:4 OR item_spec ='*' )
:1 = '自费'
:2 = 'D'
:3 = 'def00000126'
:4 = '/'
----------------------------------
Timestamp: 09:20:34.171
select calculate_type , calculate_value from clinic_type_charge_dict where clinic_type =:1 and regist_type =:2 and charge_item 
=:3
:1 = '普通号'
:2 = '初诊'
:3 = '诊察费'
----------------------------------
Timestamp: 09:20:34.227
SELECT VISIT_NO.NEXTVAL FROM DUAL
----------------------------------
Timestamp: 09:20:34.254
select dept_name from dept_dict where dept_code =:1
:1 = '3702'
----------------------------------
Timestamp: 09:20:34.285
insert into outpbill.clinic_payments_money ( visit_date , visit_no , payment_no , money_type , payment_amount , refunded_amount 
) values ( :1 , :2 , 1 , '现金' , :3 , '0' )
:1 = '2021/11/25'
:2 = 954
:3 = '9'
```

![image-20211207153824123](C:\Users\11839\AppData\Roaming\Typora\typora-user-images\image-20211207153824123.png)

#### 3 确定收费

```
确定收费费用
*****************************
----------------------------------
Timestamp: 09:23:43.488
Select sysdate From dual
----------------------------------
Timestamp: 09:23:43.516
select registration_limits , appointment_limits , current_no , registration_num from clinic_for_regist where clinic_date =:1 
and clinic_label =:2 and time_desc =:3
:1 = '2021/11/25'
:2 = '产科-刘伶俐'
:3 = '白天'
----------------------------------
Timestamp: 09:23:43.554
select count ( *) from clinic_master where mode_code ='A' and visit_date =:1 and clinic_label =:2 and visit_time_desc =:3 and 
returned_date is null
:1 = '2021/11/25'
:2 = '产科-刘伶俐'
:3 = '白天'
----------------------------------

****************************************************************************************************************************

Timestamp: 09:23:43.597
update clinic_for_regist set current_no =:1 + 1 , registration_num =:2 + 1 where clinic_date =:3 and clinic_label =:4 and 
time_desc =:5 and current_no =:6
:1 = 1
:2 = 0
:3 = '2021/11/25'
:4 = '产科-刘伶俐'
:5 = '白天'
:6 = 1
----------------------------------
Timestamp: 09:23:43.651
select count ( *) from clinic_master where mode_code ='A' and visit_date =:1 and clinic_label =:2 and visit_time_desc =:3 and 
returned_date is null and serial_no =:4
:1 = '2021/11/25'
:2 = '产科-刘伶俐'
:3 = '白天'
:4 = 1
----------------------------------

****************************************************************************************************************************


Timestamp: 09:23:43.719
Insert Into clinic_master ( 1 VISIT_DATE , 2 VISIT_NO , 3 CLINIC_LABEL , 4 VISIT_TIME_DESC , 5 SERIAL_NO , 6 PATIENT_ID , 7 NAME , 
8 NAME_PHONETIC , 9 SEX , 10 AGE , 11 Identity , 12 CHARGE_TYPE , 13 INSURANCE_TYPE , 14 INSURANCE_NO , 15 UNIT_IN_CONTRACT , 16 CLINIC_TYPE , 17 FIRST_VISIT_INDICATOR , 18 SYMPTOM , 19 VISIT_DEPT , 20 DOCTOR , 21 MR_PROVIDEd_INDICATOR , REGISTRATION_STATUS , REGISTERING_DATE , 
REGIST_FEE , CLINIC_FEE , OTHER_FEE , OPERATOR , clinic_charge , mode_code , card_name , card_no , pay_way , invoice_no , 
CLINIC_NO , FUND_PAY , tradeno , rcpt_no ) Values ( :1 , :2 , :3 , :4 , :5 , :6 , :7 , :8 , :9 , :10 , :11 , :12 , :13 , :14 , 
:15 , :16 , :17 , :18 , :19 , :20 , :21 , 1 , :22 , :23 , :24 , :25 , :26 , :27 , 'A' , :28 , :29 , :30 , :31 , :32 , :33 , :34 
, :35 )
:1 = '2021/11/25'
:2 = 954
:3 = '产科-刘伶俐'
:4 = '白天'
:5 = 1
:6 = 'M0000560'
:7 = '徐诗淳'
:8 = 'XU SHI CHUN'
:9 = '男'
:11 = '一般人员'
:12 = '自费'
:13 = <NULL>
:14 = <NULL>
:15 = ''
:16 = '普通号'
:18 = ''
:19 = '3702'
:20 = 'LLL2'
:22 = '2021/11/25 9:23:43'
:23 = '0.00'
:24 = '9.00'
:25 = '0.00'
:26 = '2586'
:27 = '9.00'
:28 = '现金'
:29 = <NULL>
:30 = '现金'
:31 = ''
:32 = '2021112500394'
:33 = '0'
:34 = ''
:35 = ''
----------------------------------
Timestamp: 09:23:44.052
Select sysdate From dual
----------------------------------
Timestamp: 09:23:44.093
select a.mailing_address from pat_master_index a where a.patient_id =:1
:1 = 'M0000560'
----------------------------------
Timestamp: 09:23:44.129
select a.user_id from users a where a.user_name =:1
:1 = '管理员'
----------------------------------
Timestamp: 09:23:44.183
SELECT "APP_CONFIGER_PARAMETER"."APP_NAME", "APP_CONFIGER_PARAMETER"."DEPT_CODE", "APP_CONFIGER_PARAMETER"."EMP_NO", 
"APP_CONFIGER_PARAMETER"."PARAMETER_NAME", "APP_CONFIGER_PARAMETER"."PARAMETER_VALUE", "APP_CONFIGER_PARAMETER"."POSITION" FROM 
"APP_CONFIGER_PARAMETER" WHERE "APP_CONFIGER_PARAMETER"."PARAMETER_NAME" = :ls_parmeter_name
:ls_parmeter_name = 'REG_PRINT'
----------------------------------
Timestamp: 09:23:44.255
select dept_name from dept_dict where dept_code =:1
:1 = '3702'
----------------------------------
Timestamp: 09:23:44.967
Successful commit.
----------------------------------
Timestamp: 09:23:44.986
SELECT "APP_CONFIGER_PARAMETER"."APP_NAME", "APP_CONFIGER_PARAMETER"."DEPT_CODE", "APP_CONFIGER_PARAMETER"."EMP_NO", 
"APP_CONFIGER_PARAMETER"."PARAMETER_NAME", "APP_CONFIGER_PARAMETER"."PARAMETER_VALUE", "APP_CONFIGER_PARAMETER"."POSITION" FROM 
"APP_CONFIGER_PARAMETER" WHERE "APP_CONFIGER_PARAMETER"."PARAMETER_NAME" = :ls_parmeter_name
:ls_parmeter_name = 'PRINT_BARCODE'
----------------------------------
Timestamp: 09:23:45.036
Successful commit.
----------------------------------
Timestamp: 09:23:45.096
select clinic_charge + fund_pay from clinic_master where visit_date =:1 and visit_no =:2
:1 = '2021/11/25'
:2 = 954
----------------------------------
Timestamp: 09:23:52.332
select count ( 1 ) from clinic_error_electronic where rcpt_no =:1 AND visit_date =:2 AND visit_no =:3
:1 = '2021112500394'
:2 = '2021/11/25'
:3 = 954
----------------------------------
Timestamp: 09:23:52.387

****************************************************************************************************************************

insert into clinic_error_electronic ( rcpt_no , is_arrears , arrears_reason , visit_date , visit_no ) values ( :1 , 1 , '' , :2 
, :3 )
:1 = '2021112500394'
:2 = '2021/11/25'
:3 = 954
----------------------------------
Timestamp: 09:23:52.429
Successful commit.
----------------------------------
Timestamp: 09:23:53.533
select patient_id , serial_no from clinic_master where visit_date =:1 and clinic_no =:2
:1 = '2021/11/25'
:2 = '2021112500394'
----------------------------------
Timestamp: 09:23:53.588
select name from pat_master_index where patient_id =:1
:1 = 'M0000560'
----------------------------------
Timestamp: 09:23:54.484
select bill_batch_code , bill_no , random from clinic_electronic_bills where rcpt_no =:1 and clinic_date =:2 and clinic_no =:3
:1 = '2021112500394'
:2 = '2021/11/25'
----------------------------------
Timestamp: 09:23:54.534
select count ( 1 ) from insurance_settle_master where settle_rcpt_no =:1
:1 = '2021112500394'
----------------------------------
Timestamp: 09:23:54.574
select count ( 1 ) from outp_settle_setlinfo_out where invono =:1
:1 = '2021112500394'
----------------------------------
Timestamp: 09:23:54.612
select fund_pay , clinic_charge , clinic_fee , operator from clinic_master where visit_date =:1 and visit_no =:2
:1 = '2021/11/25'
----------------------------------
Timestamp: 09:23:54.647
select sysdate from dual
----------------------------------
Timestamp: 09:23:54.677
select bill_qrcode                        from clinic_electronic_bills where rcpt_no ='2021112500394' and clinic_date 
=TO_DATE('25-11-2021','DD-MM-YYYY') and clinic_no =954
----------------------------------
Timestamp: 09:23:55.628
select firm from clinic_master where clinic_no =:1
:1 = '2021112500394'
----------------------------------
Timestamp: 09:23:55.667
SELECT '' rcpt_no,'' name,'' patient_id,charge_type,nvl(a.insurance_no,'无') insurance_no,'' inp_no, b.dept_name dept_name,'' 
serial_no,a.clinic_label,('金额:'||a.clinic_fee),'0' ybzhzf,'' ybtczf,'' ybdy, '' ybyydz ,'' ybqtzf,'' ybzhye,'0' zfje, '' zfsm,
'0'zje, '' sfqd ,'未知' operator, '' con_date,'' bill_batch_code, '' bill_no, '' random,'' print_date from clinic_master a,
dept_dict b where a.visit_dept = b.dept_code and visit_date = :ldt_visit_date and visit_no = :ll_visit_no
:ldt_visit_date = '2021/11/25'
:ll_visit_no = 954
----------------------------------
Timestamp: 09:24:07.148
select sysdate from dual
----------------------------------
Timestamp: 09:24:07.180
SELECT "CLINIC_FOR_REGIST"."CLINIC_LABEL", "CLINIC_FOR_REGIST"."TIME_DESC", "CLINIC_FOR_REGIST"."REGISTRATION_LIMITS", 
"CLINIC_FOR_REGIST"."APPOINTMENT_LIMITS", "CLINIC_FOR_REGIST"."REGIST_PRICE", 0, "CLINIC_INDEX"."CLINIC_DEPT", 
"CLINIC_INDEX"."DOCTOR", "CLINIC_INDEX"."DOCTOR_TITLE", "CLINIC_INDEX"."CLINIC_TYPE", "CLINIC_FOR_REGIST"."CURRENT_NO", '号', 
'', 0, "CLINIC_INDEX"."INPUT_CODE", "DEPT_DICT"."POSITION", "CLINIC_INDEX"."CLINIC_POSITION", 0 as aa, 
"CLINIC_INDEX"."CLINIC_INDEX" FROM "CLINIC_FOR_REGIST", "CLINIC_INDEX", "DEPT_DICT" WHERE ( "CLINIC_FOR_REGIST"."CLINIC_LABEL" 
= "CLINIC_INDEX"."CLINIC_LABEL" ) and ( "CLINIC_INDEX"."CLINIC_DEPT" = "DEPT_DICT"."DEPT_CODE" ) and ( 
CLINIC_FOR_REGIST.CLINIC_DATE = :day1 )
:day1 = '2021/11/25'
----------------------------------
Timestamp: 09:24:07.251
SELECT "APP_CONFIGER_PARAMETER"."APP_NAME", "APP_CONFIGER_PARAMETER"."DEPT_CODE", "APP_CONFIGER_PARAMETER"."EMP_NO", 
"APP_CONFIGER_PARAMETER"."PARAMETER_NAME", "APP_CONFIGER_PARAMETER"."PARAMETER_VALUE", "APP_CONFIGER_PARAMETER"."POSITION" FROM 
"APP_CONFIGER_PARAMETER" WHERE "APP_CONFIGER_PARAMETER"."PARAMETER_NAME" = :ls_parmeter_name
:ls_parmeter_name = 'FIRST_CLINIC_FLAG'
----------------------------------
Timestamp: 09:24:07.302
SELECT "APP_CONFIGER_PARAMETER"."APP_NAME", "APP_CONFIGER_PARAMETER"."DEPT_CODE", "APP_CONFIGER_PARAMETER"."EMP_NO", 
"APP_CONFIGER_PARAMETER"."PARAMETER_NAME", "APP_CONFIGER_PARAMETER"."PARAMETER_VALUE", "APP_CONFIGER_PARAMETER"."POSITION" FROM 
"APP_CONFIGER_PARAMETER" WHERE "APP_CONFIGER_PARAMETER"."PARAMETER_NAME" = :ls_parmeter_name
:ls_parmeter_name = 'MR_PROVIDE'
----------------------------------
Timestamp: 09:24:07.351
SELECT "APP_CONFIGER_PARAMETER"."APP_NAME", "APP_CONFIGER_PARAMETER"."DEPT_CODE", "APP_CONFIGER_PARAMETER"."EMP_NO", 
"APP_CONFIGER_PARAMETER"."PARAMETER_NAME", "APP_CONFIGER_PARAMETER"."PARAMETER_VALUE", "APP_CONFIGER_PARAMETER"."POSITION" FROM 
"APP_CONFIGER_PARAMETER" WHERE "APP_CONFIGER_PARAMETER"."PARAMETER_NAME" = :ls_parmeter_name
:ls_parmeter_name = 'OTHER_FEE'
----------------------------------
Timestamp: 09:24:07.398
SELECT "APP_CONFIGER_PARAMETER"."APP_NAME", "APP_CONFIGER_PARAMETER"."DEPT_CODE", "APP_CONFIGER_PARAMETER"."EMP_NO", 
"APP_CONFIGER_PARAMETER"."PARAMETER_NAME", "APP_CONFIGER_PARAMETER"."PARAMETER_VALUE", "APP_CONFIGER_PARAMETER"."POSITION" FROM 
"APP_CONFIGER_PARAMETER" WHERE "APP_CONFIGER_PARAMETER"."PARAMETER_NAME" = :ls_parmeter_name
:ls_parmeter_name = 'CREATE_OUTP_MR'
----------------------------------
Timestamp: 09:24:07.444
SELECT "APP_CONFIGER_PARAMETER"."APP_NAME", "APP_CONFIGER_PARAMETER"."DEPT_CODE", "APP_CONFIGER_PARAMETER"."EMP_NO", 
"APP_CONFIGER_PARAMETER"."PARAMETER_NAME", "APP_CONFIGER_PARAMETER"."PARAMETER_VALUE", "APP_CONFIGER_PARAMETER"."POSITION" FROM 
"APP_CONFIGER_PARAMETER" WHERE "APP_CONFIGER_PARAMETER"."PARAMETER_NAME" = :ls_parmeter_name
:ls_parmeter_name = 'CHARGE_TYPE_REG'
----------------------------------
Timestamp: 09:24:07.491
SELECT "APP_CONFIGER_PARAMETER"."APP_NAME", "APP_CONFIGER_PARAMETER"."DEPT_CODE", "APP_CONFIGER_PARAMETER"."EMP_NO", 
"APP_CONFIGER_PARAMETER"."PARAMETER_NAME", "APP_CONFIGER_PARAMETER"."PARAMETER_VALUE", "APP_CONFIGER_PARAMETER"."POSITION" FROM 
"APP_CONFIGER_PARAMETER" WHERE "APP_CONFIGER_PARAMETER"."PARAMETER_NAME" = :ls_parmeter_name
:ls_parmeter_name = 'IDENTITY'
----------------------------------
Timestamp: 09:24:07.539
SELECT "APP_CONFIGER_PARAMETER"."APP_NAME", "APP_CONFIGER_PARAMETER"."DEPT_CODE", "APP_CONFIGER_PARAMETER"."EMP_NO", 
"APP_CONFIGER_PARAMETER"."PARAMETER_NAME", "APP_CONFIGER_PARAMETER"."PARAMETER_VALUE", "APP_CONFIGER_PARAMETER"."POSITION" FROM 
"APP_CONFIGER_PARAMETER" WHERE "APP_CONFIGER_PARAMETER"."PARAMETER_NAME" = :ls_parmeter_name
:ls_parmeter_name = 'CARD_NAME'
----------------------------------
Timestamp: 09:24:07.619
SELECT "APP_CONFIGER_PARAMETER"."APP_NAME", "APP_CONFIGER_PARAMETER"."DEPT_CODE", "APP_CONFIGER_PARAMETER"."EMP_NO", 
"APP_CONFIGER_PARAMETER"."PARAMETER_NAME", "APP_CONFIGER_PARAMETER"."PARAMETER_VALUE", "APP_CONFIGER_PARAMETER"."POSITION" FROM 
"APP_CONFIGER_PARAMETER" WHERE "APP_CONFIGER_PARAMETER"."PARAMETER_NAME" = :ls_parmeter_name
:ls_parmeter_name = 'USE_INVOICE_FLAG'
----------------------------------
Timestamp: 09:24:07.666
SELECT "APP_CONFIGER_PARAMETER"."APP_NAME", "APP_CONFIGER_PARAMETER"."DEPT_CODE", "APP_CONFIGER_PARAMETER"."EMP_NO", 
"APP_CONFIGER_PARAMETER"."PARAMETER_NAME", "APP_CONFIGER_PARAMETER"."PARAMETER_VALUE", "APP_CONFIGER_PARAMETER"."POSITION" FROM 
"APP_CONFIGER_PARAMETER" WHERE "APP_CONFIGER_PARAMETER"."PARAMETER_NAME" = :ls_parmeter_name
:ls_parmeter_name = 'REGIST_INVOICE_FLAG'
```

#### 此时再看产科-刘伶俐 人数变为2了



### 情况二：初次就诊，新增病人

```
Timestamp: 09:58:39.035
select patient_id,name,name_phonetic,sex,date_of_birth,nation,identity,charge_type,mailing_address,phone_number_home,id_no from 
pat_master_index where name=:name
:name = '陈伟1'
----------------------------------
Timestamp: 09:58:40.236
SELECT "APP_CONFIGER_PARAMETER"."APP_NAME", "APP_CONFIGER_PARAMETER"."DEPT_CODE", "APP_CONFIGER_PARAMETER"."EMP_NO", 
"APP_CONFIGER_PARAMETER"."PARAMETER_NAME", "APP_CONFIGER_PARAMETER"."PARAMETER_VALUE", "APP_CONFIGER_PARAMETER"."POSITION" FROM 
"APP_CONFIGER_PARAMETER" WHERE "APP_CONFIGER_PARAMETER"."PARAMETER_NAME" = :ls_parmeter_name
:ls_parmeter_name = 'INSURANCE_CHARGE_TYPE_REG'
----------------------------------
Timestamp: 09:58:46.994
SELECT "APP_CONFIGER_PARAMETER"."APP_NAME", "APP_CONFIGER_PARAMETER"."DEPT_CODE", "APP_CONFIGER_PARAMETER"."EMP_NO", 
"APP_CONFIGER_PARAMETER"."PARAMETER_NAME", "APP_CONFIGER_PARAMETER"."PARAMETER_VALUE", "APP_CONFIGER_PARAMETER"."POSITION" FROM 
"APP_CONFIGER_PARAMETER" WHERE "APP_CONFIGER_PARAMETER"."PARAMETER_NAME" = :ls_parmeter_name
:ls_parmeter_name = 'SET_AGE'
----------------------------------
Timestamp: 09:58:47.044
select sysdate from dual
----------------------------------
Timestamp: 09:58:47.091
select registration_limits , appointment_limits , current_no , registration_num from clinic_for_regist where clinic_date =:1 
and clinic_label =:2 and time_desc =:3
:1 = '2021/11/25'
:2 = '体检免费'
:3 = '白天'
----------------------------------
Timestamp: 09:58:47.152
select count ( *) from clinic_master where mode_code ='A' and visit_date =:1 and clinic_label =:2 and visit_time_desc =:3 and 
returned_date is null
:1 = '2021/11/25'
:2 = '体检免费'
:3 = '白天'
----------------------------------
Timestamp: 09:58:47.211
select count ( *) from unit_in_contract where unit_name =:1
:1 = ''
----------------------------------
Timestamp: 09:58:47.262
select a.unit_code from unit_in_contract a where a.unit_name =:1
:1 = ''
----------------------------------
Timestamp: 09:58:47.351
SELECT "APP_CONFIGER_PARAMETER"."APP_NAME", "APP_CONFIGER_PARAMETER"."DEPT_CODE", "APP_CONFIGER_PARAMETER"."EMP_NO", 
"APP_CONFIGER_PARAMETER"."PARAMETER_NAME", "APP_CONFIGER_PARAMETER"."PARAMETER_VALUE", "APP_CONFIGER_PARAMETER"."POSITION" FROM 
"APP_CONFIGER_PARAMETER" WHERE "APP_CONFIGER_PARAMETER"."PARAMETER_NAME" = :ls_parmeter_name
:ls_parmeter_name = 'INSURANCE_ACCOUNT'
----------------------------------
Timestamp: 09:58:47.399
SELECT "APP_CONFIGER_PARAMETER"."APP_NAME", "APP_CONFIGER_PARAMETER"."DEPT_CODE", "APP_CONFIGER_PARAMETER"."EMP_NO", 
"APP_CONFIGER_PARAMETER"."PARAMETER_NAME", "APP_CONFIGER_PARAMETER"."PARAMETER_VALUE", "APP_CONFIGER_PARAMETER"."POSITION" FROM 
"APP_CONFIGER_PARAMETER" WHERE "APP_CONFIGER_PARAMETER"."PARAMETER_NAME" = :ls_parmeter_name
:ls_parmeter_name = 'INSURANCE_CHARGE_TYPE_REG'
----------------------------------
Timestamp: 09:58:47.450
SELECT "APP_CONFIGER_PARAMETER"."APP_NAME", "APP_CONFIGER_PARAMETER"."DEPT_CODE", "APP_CONFIGER_PARAMETER"."EMP_NO", 
"APP_CONFIGER_PARAMETER"."PARAMETER_NAME", "APP_CONFIGER_PARAMETER"."PARAMETER_VALUE", "APP_CONFIGER_PARAMETER"."POSITION" FROM 
"APP_CONFIGER_PARAMETER" WHERE "APP_CONFIGER_PARAMETER"."PARAMETER_NAME" = :ls_parmeter_name
:ls_parmeter_name = 'REG_PREPAYMENT_FLAG'
----------------------------------
Timestamp: 09:58:47.498
SELECT "APP_CONFIGER_PARAMETER"."APP_NAME", "APP_CONFIGER_PARAMETER"."DEPT_CODE", "APP_CONFIGER_PARAMETER"."EMP_NO", 
"APP_CONFIGER_PARAMETER"."PARAMETER_NAME", "APP_CONFIGER_PARAMETER"."PARAMETER_VALUE", "APP_CONFIGER_PARAMETER"."POSITION" FROM 
"APP_CONFIGER_PARAMETER" WHERE "APP_CONFIGER_PARAMETER"."PARAMETER_NAME" = :ls_parmeter_name
:ls_parmeter_name = 'AUTO_ID_TYPE'
----------------------------------
Timestamp: 09:58:47.546
SELECT "APP_CONFIGER_PARAMETER"."APP_NAME", "APP_CONFIGER_PARAMETER"."DEPT_CODE", "APP_CONFIGER_PARAMETER"."EMP_NO", 
"APP_CONFIGER_PARAMETER"."PARAMETER_NAME", "APP_CONFIGER_PARAMETER"."PARAMETER_VALUE", "APP_CONFIGER_PARAMETER"."POSITION" FROM 
"APP_CONFIGER_PARAMETER" WHERE "APP_CONFIGER_PARAMETER"."PARAMETER_NAME" = :ls_parmeter_name
:ls_parmeter_name = 'AUTO_PID'
----------------------------------
Timestamp: 09:58:47.586
select ID_START_VALUE , ID_CURRENTLY_VALUE , ID_LENGTH , ID_UPGRADE , ID_SQL from auto_setting_id where SERIAL_NO =:1
----------------------------------
Timestamp: 09:58:47.621
update auto_setting_id set ID_CURRENTLY_VALUE =:1 + 1 where SERIAL_NO =:2
:1 = 44411
----------------------------------
Timestamp: 09:58:47.651
Successful commit.
----------------------------------
Timestamp: 09:58:47.663
select count ( *) from pat_master_index where patient_id =:1
:1 = 'M0044411'
----------------------------------
Timestamp: 09:58:47.704
select patient_id from pat_master_index where patient_id =:1
:1 = 'M0044411'
----------------------------------
Timestamp: 09:58:47.733
select a.region_name from area_to_dict a where a.region_code =:1
:1 = <NULL>
----------------------------------
Timestamp: 09:58:47.763
select a.region_name from area_to_dict a where a.region_code =:1
:1 = <NULL>
----------------------------------
Timestamp: 09:58:47.792
select a.region_name from area_to_dict a where a.region_code =:1
:1 = <NULL>
----------------------------------
Timestamp: 09:58:47.825
Insert into pat_master_index ( patient_id , name , name_phonetic , sex , date_of_birth , charge_type , identity , birth_place , 
vip_indicator , create_date , operator , unit_in_contract , PHONE_NUMBER_HOME , MAILING_ADDRESS , province , city , county , 
detailed_address , id_no ) values ( :1 , :2 , :3 , :4 , :5 , :6 , :7 , :8 , 0 , sysdate , :9 , :10 , :11 , :12 , :13 , :14 , 
:15 , :16 , :17 )
:1 = 'M0044411'
:2 = '陈伟1'
:3 = 'CHEN WEI'
:4 = '男'
:5 = <NULL>
:6 = '自费'
:7 = '一般人员'
:8 = ''
:9 = '管理员'
:10 = ''
:11 = ''
:12 = <NULL>
:13 = <NULL>
:14 = <NULL>
:15 = <NULL>
:16 = <NULL>
:17 = <NULL>
----------------------------------
Timestamp: 09:58:47.984
select sysdate from dual
----------------------------------
Timestamp: 09:58:48.017
SELECT TO_CHAR ( SYSDATE , 'yyyymmdd' ) || LPAD ( TO_CHAR ( OUTPBILL.SQ_RCPT_NUMBER.NEXTVAL ) , 6 , '0' ) , 
OUTPBILL.SQ_RCPT_NUMBER.NEXTVAL FROM DUAL
----------------------------------
Timestamp: 09:58:48.051
select count ( *) from clinic_master where visit_date =trunc ( sysdate ) and visit_no =:1
:1 = 401
----------------------------------
Timestamp: 09:58:48.097
select clinic_type , clinic_position , clinic_dept , doctor from CLINIC_INDEX where CLINIC_LABEL =:1
:1 = '体检免费'
----------------------------------
Timestamp: 09:58:48.142
select id , id_no , name from staff_dict where emp_no =:1
:1 = 'CXY2'
----------------------------------
Timestamp: 09:58:48.173
select price_item from clinic_type_setting where charge_item =:1 and clinic_type =:2
:1 = '诊察费'
:2 = '免费号'
----------------------------------
Timestamp: 09:58:48.237
select item_class , item_spec , price from current_price_list where item_code =:1
:1 = 'OTHER0002'
----------------------------------
Timestamp: 09:58:48.281
select PRICE_COEFF_NUMERATOR , PRICE_COEFF_DENOMINATOR from CHARGE_PRICE_SCHEDULE where charge_type =:1
:1 = '自费'
----------------------------------
Timestamp: 09:58:48.324
select charge_special_indicator from CHARGE_PRICE_SCHEDULE where charge_type =:1
:1 = '自费'
----------------------------------
Timestamp: 09:58:48.366
SELECT proportion_numerator , proportion_denominator , free_limit FROM charge_special_except_dict WHERE charge_type =:1 AND 
item_class =:2 AND ( item_code =:3 OR item_code ='*' ) AND ( item_spec =:4 OR item_spec ='*' )
:1 = '自费'
:2 = 'Z'
:3 = 'OTHER0002'
:4 = '/'
----------------------------------
Timestamp: 09:58:48.426
SELECT proportion_numerator , proportion_denominator , free_limit FROM charge_special_item_dict WHERE charge_type =:1 AND 
item_class =:2 AND ( item_code =:3 OR item_code ='*' ) AND ( item_spec =:4 OR item_spec ='*' )
:1 = '自费'
:2 = 'Z'
:3 = 'OTHER0002'
:4 = '/'
----------------------------------
Timestamp: 09:58:48.486
select calculate_type , calculate_value from clinic_type_charge_dict where clinic_type =:1 and regist_type =:2 and charge_item 
=:3
:1 = '免费号'
:2 = '初诊'
:3 = '诊察费'
----------------------------------
Timestamp: 09:58:48.546
SELECT VISIT_NO.NEXTVAL FROM DUAL
----------------------------------
Timestamp: 09:58:48.580
select dept_name from dept_dict where dept_code =:1
:1 = '29'
----------------------------------
Timestamp: 09:58:48.623
insert into outpbill.clinic_payments_money ( visit_date , visit_no , payment_no , money_type , payment_amount , refunded_amount 
) values ( :1 , :2 , 1 , '现金' , :3 , '0' )
:1 = '2021/11/25'
:2 = 961
:3 = '0'
----------------------------------
Timestamp: 09:58:48.693
SELECT "APP_CONFIGER_PARAMETER"."APP_NAME", "APP_CONFIGER_PARAMETER"."DEPT_CODE", "APP_CONFIGER_PARAMETER"."EMP_NO", 
"APP_CONFIGER_PARAMETER"."PARAMETER_NAME", "APP_CONFIGER_PARAMETER"."PARAMETER_VALUE", "APP_CONFIGER_PARAMETER"."POSITION" FROM 
"APP_CONFIGER_PARAMETER" WHERE "APP_CONFIGER_PARAMETER"."PARAMETER_NAME" = :ls_parmeter_name
:ls_parmeter_name = 'USE_INVOICE_FLAG'
----------------------------------
Timestamp: 09:58:48.743
SELECT "APP_CONFIGER_PARAMETER"."APP_NAME", "APP_CONFIGER_PARAMETER"."DEPT_CODE", "APP_CONFIGER_PARAMETER"."EMP_NO", 
"APP_CONFIGER_PARAMETER"."PARAMETER_NAME", "APP_CONFIGER_PARAMETER"."PARAMETER_VALUE", "APP_CONFIGER_PARAMETER"."POSITION" FROM 
"APP_CONFIGER_PARAMETER" WHERE "APP_CONFIGER_PARAMETER"."PARAMETER_NAME" = :ls_parmeter_name
:ls_parmeter_name = 'REGIST_INVOICE_FLAG'
----------------------------------
Timestamp: 09:58:48.800
SELECT "APP_CONFIGER_PARAMETER"."APP_NAME", "APP_CONFIGER_PARAMETER"."DEPT_CODE", "APP_CONFIGER_PARAMETER"."EMP_NO", 
"APP_CONFIGER_PARAMETER"."PARAMETER_NAME", "APP_CONFIGER_PARAMETER"."PARAMETER_VALUE", "APP_CONFIGER_PARAMETER"."POSITION" FROM 
"APP_CONFIGER_PARAMETER" WHERE "APP_CONFIGER_PARAMETER"."PARAMETER_NAME" = :ls_parmeter_name
:ls_parmeter_name = 'NORMAL_REG_PRINT_FLAG'
----------------------------------
Timestamp: 09:58:48.843
SELECT "APP_CONFIGER_PARAMETER"."APP_NAME", "APP_CONFIGER_PARAMETER"."DEPT_CODE", "APP_CONFIGER_PARAMETER"."EMP_NO", 
"APP_CONFIGER_PARAMETER"."PARAMETER_NAME", "APP_CONFIGER_PARAMETER"."PARAMETER_VALUE", "APP_CONFIGER_PARAMETER"."POSITION" FROM 
"APP_CONFIGER_PARAMETER" WHERE "APP_CONFIGER_PARAMETER"."PARAMETER_NAME" = :ls_parmeter_name
:ls_parmeter_name = 'BJYB_REG_PRINT_FLAG'
********************************
确认收费
*******************************
----------------------------------
Timestamp: 09:59:19.855
Select sysdate From dual
----------------------------------
Timestamp: 09:59:19.905
select registration_limits , appointment_limits , current_no , registration_num from clinic_for_regist where clinic_date =:1 
and clinic_label =:2 and time_desc =:3
:1 = '2021/11/25'
:2 = '体检免费'
:3 = '白天'
----------------------------------
Timestamp: 09:59:19.962
select count ( *) from clinic_master where mode_code ='A' and visit_date =:1 and clinic_label =:2 and visit_time_desc =:3 and 
returned_date is null
:1 = '2021/11/25'
:2 = '体检免费'
:3 = '白天'
----------------------------------
Timestamp: 09:59:20.022
update clinic_for_regist set current_no =:1 + 1 , registration_num =:2 + 1 where clinic_date =:3 and clinic_label =:4 and 
time_desc =:5 and current_no =:6
:1 = 3
:2 = 2
:3 = '2021/11/25'
:4 = '体检免费'
:5 = '白天'
:6 = 3
----------------------------------
Timestamp: 09:59:20.098
select count ( *) from clinic_master where mode_code ='A' and visit_date =:1 and clinic_label =:2 and visit_time_desc =:3 and 
returned_date is null and serial_no =:4
:1 = '2021/11/25'
:2 = '体检免费'
:3 = '白天'
:4 = 3
----------------------------------
Timestamp: 09:59:20.169
Insert Into clinic_master ( VISIT_DATE , VISIT_NO , CLINIC_LABEL , VISIT_TIME_DESC , SERIAL_NO , PATIENT_ID , NAME , 
NAME_PHONETIC , SEX , AGE , Identity , CHARGE_TYPE , INSURANCE_TYPE , INSURANCE_NO , UNIT_IN_CONTRACT , CLINIC_TYPE , 
FIRST_VISIT_INDICATOR , SYMPTOM , VISIT_DEPT , DOCTOR , MR_PROVIDEd_INDICATOR , REGISTRATION_STATUS , REGISTERING_DATE , 
REGIST_FEE , CLINIC_FEE , OTHER_FEE , OPERATOR , clinic_charge , mode_code , card_name , card_no , pay_way , invoice_no , 
CLINIC_NO , FUND_PAY , tradeno , rcpt_no ) Values ( :1 , :2 , :3 , :4 , :5 , :6 , :7 , :8 , :9 , :10 , :11 , :12 , :13 , :14 , 
:15 , :16 , :17 , :18 , :19 , :20 , :21 , 1 , :22 , :23 , :24 , :25 , :26 , :27 , 'A' , :28 , :29 , :30 , :31 , :32 , :33 , :34 
, :35 )
:1 = '2021/11/25'
:2 = 961
:3 = '体检免费'
:4 = '白天'
:5 = 3
:6 = 'M0044411'
:7 = '陈伟1'
:8 = 'CHEN WEI'
:9 = '男'
:10 = <NULL>
:11 = '一般人员'
:12 = '自费'
:13 = <NULL>
:14 = <NULL>
:15 = ''
:16 = '免费号'
:18 = ''
:19 = '29'
:20 = 'CXY2'
:22 = '2021/11/25 9:59:19'
:23 = '0.00'
:24 = '0.00'
:25 = '0.00'
:26 = '2586'
:27 = '0'
:28 = '现金'
:29 = <NULL>
:30 = '现金'
:31 = ''
:32 = '2021112500401'
:33 = '0'
:34 = ''
:35 = ''
----------------------------------
Timestamp: 09:59:20.451
Select sysdate From dual
----------------------------------
Timestamp: 09:59:20.490
Select trunc ( MONTHS_BETWEEN ( SYSDATE , "PAT_MASTER_INDEX"."DATE_OF_BIRTH" ) / 12 ) From pat_master_index Where patient_id =:1
:1 = 'M0044411'
----------------------------------
Timestamp: 09:59:20.538
select a.mailing_address from pat_master_index a where a.patient_id =:1
:1 = 'M0044411'
----------------------------------
Timestamp: 09:59:20.580
select a.user_id from users a where a.user_name =:1
:1 = '管理员'
----------------------------------
Timestamp: 09:59:20.622
SELECT "APP_CONFIGER_PARAMETER"."APP_NAME", "APP_CONFIGER_PARAMETER"."DEPT_CODE", "APP_CONFIGER_PARAMETER"."EMP_NO", 
"APP_CONFIGER_PARAMETER"."PARAMETER_NAME", "APP_CONFIGER_PARAMETER"."PARAMETER_VALUE", "APP_CONFIGER_PARAMETER"."POSITION" FROM 
"APP_CONFIGER_PARAMETER" WHERE "APP_CONFIGER_PARAMETER"."PARAMETER_NAME" = :ls_parmeter_name
:ls_parmeter_name = 'REG_PRINT'
----------------------------------
Timestamp: 09:59:20.669
select dept_name from dept_dict where dept_code =:1
:1 = '29'
----------------------------------
Timestamp: 09:59:20.992
Successful commit.
----------------------------------
Timestamp: 09:59:21.014
SELECT "APP_CONFIGER_PARAMETER"."APP_NAME", "APP_CONFIGER_PARAMETER"."DEPT_CODE", "APP_CONFIGER_PARAMETER"."EMP_NO", 
"APP_CONFIGER_PARAMETER"."PARAMETER_NAME", "APP_CONFIGER_PARAMETER"."PARAMETER_VALUE", "APP_CONFIGER_PARAMETER"."POSITION" FROM 
"APP_CONFIGER_PARAMETER" WHERE "APP_CONFIGER_PARAMETER"."PARAMETER_NAME" = :ls_parmeter_name
:ls_parmeter_name = 'PRINT_BARCODE'
----------------------------------
Timestamp: 09:59:21.057
Successful commit.
----------------------------------
Timestamp: 09:59:21.057
select clinic_charge + fund_pay from clinic_master where visit_date =:1 and visit_no =:2
:1 = '2021/11/25'
:2 = 961

**************
----------------------------------
Timestamp: 09:59:34.657
select sysdate from dual
----------------------------------
Timestamp: 09:59:34.693
SELECT "CLINIC_FOR_REGIST"."CLINIC_LABEL", "CLINIC_FOR_REGIST"."TIME_DESC", "CLINIC_FOR_REGIST"."REGISTRATION_LIMITS", 
"CLINIC_FOR_REGIST"."APPOINTMENT_LIMITS", "CLINIC_FOR_REGIST"."REGIST_PRICE", 0, "CLINIC_INDEX"."CLINIC_DEPT", 
"CLINIC_INDEX"."DOCTOR", "CLINIC_INDEX"."DOCTOR_TITLE", "CLINIC_INDEX"."CLINIC_TYPE", "CLINIC_FOR_REGIST"."CURRENT_NO", '号', 
'', 0, "CLINIC_INDEX"."INPUT_CODE", "DEPT_DICT"."POSITION", "CLINIC_INDEX"."CLINIC_POSITION", 0 as aa, 
"CLINIC_INDEX"."CLINIC_INDEX" FROM "CLINIC_FOR_REGIST", "CLINIC_INDEX", "DEPT_DICT" WHERE ( "CLINIC_FOR_REGIST"."CLINIC_LABEL" 
= "CLINIC_INDEX"."CLINIC_LABEL" ) and ( "CLINIC_INDEX"."CLINIC_DEPT" = "DEPT_DICT"."DEPT_CODE" ) and ( 
CLINIC_FOR_REGIST.CLINIC_DATE = :day1 )
:day1 = '2021/11/25'
----------------------------------
Timestamp: 09:59:34.757
SELECT "APP_CONFIGER_PARAMETER"."APP_NAME", "APP_CONFIGER_PARAMETER"."DEPT_CODE", "APP_CONFIGER_PARAMETER"."EMP_NO", 
"APP_CONFIGER_PARAMETER"."PARAMETER_NAME", "APP_CONFIGER_PARAMETER"."PARAMETER_VALUE", "APP_CONFIGER_PARAMETER"."POSITION" FROM 
"APP_CONFIGER_PARAMETER" WHERE "APP_CONFIGER_PARAMETER"."PARAMETER_NAME" = :ls_parmeter_name
:ls_parmeter_name = 'FIRST_CLINIC_FLAG'
----------------------------------
Timestamp: 09:59:34.808
SELECT "APP_CONFIGER_PARAMETER"."APP_NAME", "APP_CONFIGER_PARAMETER"."DEPT_CODE", "APP_CONFIGER_PARAMETER"."EMP_NO", 
"APP_CONFIGER_PARAMETER"."PARAMETER_NAME", "APP_CONFIGER_PARAMETER"."PARAMETER_VALUE", "APP_CONFIGER_PARAMETER"."POSITION" FROM 
"APP_CONFIGER_PARAMETER" WHERE "APP_CONFIGER_PARAMETER"."PARAMETER_NAME" = :ls_parmeter_name
:ls_parmeter_name = 'MR_PROVIDE'
----------------------------------
Timestamp: 09:59:34.869
SELECT "APP_CONFIGER_PARAMETER"."APP_NAME", "APP_CONFIGER_PARAMETER"."DEPT_CODE", "APP_CONFIGER_PARAMETER"."EMP_NO", 
"APP_CONFIGER_PARAMETER"."PARAMETER_NAME", "APP_CONFIGER_PARAMETER"."PARAMETER_VALUE", "APP_CONFIGER_PARAMETER"."POSITION" FROM 
"APP_CONFIGER_PARAMETER" WHERE "APP_CONFIGER_PARAMETER"."PARAMETER_NAME" = :ls_parmeter_name
:ls_parmeter_name = 'OTHER_FEE'
----------------------------------
Timestamp: 09:59:34.922
SELECT "APP_CONFIGER_PARAMETER"."APP_NAME", "APP_CONFIGER_PARAMETER"."DEPT_CODE", "APP_CONFIGER_PARAMETER"."EMP_NO", 
"APP_CONFIGER_PARAMETER"."PARAMETER_NAME", "APP_CONFIGER_PARAMETER"."PARAMETER_VALUE", "APP_CONFIGER_PARAMETER"."POSITION" FROM 
"APP_CONFIGER_PARAMETER" WHERE "APP_CONFIGER_PARAMETER"."PARAMETER_NAME" = :ls_parmeter_name
:ls_parmeter_name = 'CREATE_OUTP_MR'
----------------------------------
Timestamp: 09:59:34.974
SELECT "APP_CONFIGER_PARAMETER"."APP_NAME", "APP_CONFIGER_PARAMETER"."DEPT_CODE", "APP_CONFIGER_PARAMETER"."EMP_NO", 
"APP_CONFIGER_PARAMETER"."PARAMETER_NAME", "APP_CONFIGER_PARAMETER"."PARAMETER_VALUE", "APP_CONFIGER_PARAMETER"."POSITION" FROM 
"APP_CONFIGER_PARAMETER" WHERE "APP_CONFIGER_PARAMETER"."PARAMETER_NAME" = :ls_parmeter_name
:ls_parmeter_name = 'CHARGE_TYPE_REG'
----------------------------------
Timestamp: 09:59:35.041
SELECT "APP_CONFIGER_PARAMETER"."APP_NAME", "APP_CONFIGER_PARAMETER"."DEPT_CODE", "APP_CONFIGER_PARAMETER"."EMP_NO", 
"APP_CONFIGER_PARAMETER"."PARAMETER_NAME", "APP_CONFIGER_PARAMETER"."PARAMETER_VALUE", "APP_CONFIGER_PARAMETER"."POSITION" FROM 
"APP_CONFIGER_PARAMETER" WHERE "APP_CONFIGER_PARAMETER"."PARAMETER_NAME" = :ls_parmeter_name
:ls_parmeter_name = 'IDENTITY'
----------------------------------
Timestamp: 09:59:35.099
SELECT "APP_CONFIGER_PARAMETER"."APP_NAME", "APP_CONFIGER_PARAMETER"."DEPT_CODE", "APP_CONFIGER_PARAMETER"."EMP_NO", 
"APP_CONFIGER_PARAMETER"."PARAMETER_NAME", "APP_CONFIGER_PARAMETER"."PARAMETER_VALUE", "APP_CONFIGER_PARAMETER"."POSITION" FROM 
"APP_CONFIGER_PARAMETER" WHERE "APP_CONFIGER_PARAMETER"."PARAMETER_NAME" = :ls_parmeter_name
:ls_parmeter_name = 'CARD_NAME'
----------------------------------
Timestamp: 09:59:35.207
SELECT "APP_CONFIGER_PARAMETER"."APP_NAME", "APP_CONFIGER_PARAMETER"."DEPT_CODE", "APP_CONFIGER_PARAMETER"."EMP_NO", 
"APP_CONFIGER_PARAMETER"."PARAMETER_NAME", "APP_CONFIGER_PARAMETER"."PARAMETER_VALUE", "APP_CONFIGER_PARAMETER"."POSITION" FROM 
"APP_CONFIGER_PARAMETER" WHERE "APP_CONFIGER_PARAMETER"."PARAMETER_NAME" = :ls_parmeter_name
:ls_parmeter_name = 'USE_INVOICE_FLAG'
----------------------------------
Timestamp: 09:59:35.277
SELECT "APP_CONFIGER_PARAMETER"."APP_NAME", "APP_CONFIGER_PARAMETER"."DEPT_CODE", "APP_CONFIGER_PARAMETER"."EMP_NO", 
"APP_CONFIGER_PARAMETER"."PARAMETER_NAME", "APP_CONFIGER_PARAMETER"."PARAMETER_VALUE", "APP_CONFIGER_PARAMETER"."POSITION" FROM 
"APP_CONFIGER_PARAMETER" WHERE "APP_CONFIGER_PARAMETER"."PARAMETER_NAME" = :ls_parmeter_name
:ls_parmeter_name = 'REGIST_INVOICE_FLAG'
```





### 4 再进入门诊医生医生工作站，这里是用管理员账号登录，可以看到所有病人。

```
       全科 -> 当天病人
***********************************
----------------------------------
Timestamp: 09:38:30.565
select sysdate from dual
----------------------------------
Timestamp: 09:38:30.622
SELECT "CLINIC_MASTER"."NAME", "OUTP_WAIT_QUEUE"."QUEUE_NAME", "OUTP_WAIT_QUEUE"."REGISTER_DEPT", 
"OUTP_WAIT_QUEUE"."QUEUE_SEQUENCE", "OUTP_WAIT_QUEUE"."REGISTER_DATE", "CLINIC_MASTER"."PATIENT_ID", 
"CLINIC_MASTER"."CLINIC_TYPE", "CLINIC_MASTER"."VISIT_DATE", "CLINIC_MASTER"."VISIT_NO", "CLINIC_MASTER"."SERIAL_NO", 
"CLINIC_MASTER"."SEX", "OUTP_WAIT_QUEUE"."WORKED_INDICATOR", "OUTP_WAIT_QUEUE"."DOCTOR", "OUTP_WAIT_QUEUE"."DOCTOR_NO", 
"CLINIC_MASTER"."VISIT_DEPT", "DEPT_DICT"."DEPT_NAME", "OUTP_WAIT_QUEUE"."COUNSEL_NO" FROM "DEPT_DICT" ,
"CLINIC_MASTER", "OUTP_WAIT_QUEUE"
WHERE ( "CLINIC_MASTER"."VISIT_DEPT"= "DEPT_DICT"."DEPT_CODE" (+)) AND ( "CLINIC_MASTER"."VISIT_DATE" = 
"OUTP_WAIT_QUEUE"."VISIT_DATE" ) and ( "CLINIC_MASTER"."VISIT_NO" = "OUTP_WAIT_QUEUE"."VISIT_NO" ) and ( 
"OUTP_WAIT_QUEUE"."VISIT_DATE" >= :day) and
( "OUTP_WAIT_QUEUE"."REGISTER_DEPT" = :dept_code ) AND ( "OUTP_WAIT_QUEUE"."WORKED_INDICATOR" <> 0 )
:day = '2021/9/26'
:dept_code = '3702'
----------------------------------
Timestamp: 09:38:30.788
select sysdate from dual
----------------------------------
Timestamp: 09:38:30.839
SELECT DISTINCT "CLINIC_MASTER"."NAME" , "OUTP_WAIT_QUEUE"."QUEUE_NAME",
"OUTP_WAIT_QUEUE"."REGISTER_DEPT", "OUTP_WAIT_QUEUE"."QUEUE_SEQUENCE", "OUTP_WAIT_QUEUE"."REGISTER_DATE", 
"CLINIC_MASTER"."PATIENT_ID", "CLINIC_MASTER"."CLINIC_TYPE", "CLINIC_MASTER"."VISIT_DATE", "CLINIC_MASTER"."VISIT_NO" ,
"CLINIC_MASTER"."SERIAL_NO",
"CLINIC_MASTER"."VISIT_DEPT",
"CLINIC_MASTER"."SEX" ,
"OUTP_WAIT_QUEUE"."DOCTOR_NO" FROM "CLINIC_MASTER", "OUTP_WAIT_QUEUE"
WHERE ( "CLINIC_MASTER"."VISIT_DATE" = "OUTP_WAIT_QUEUE"."VISIT_DATE") and ( "CLINIC_MASTER"."VISIT_NO" = 
"OUTP_WAIT_QUEUE"."VISIT_NO" ) and ( "OUTP_WAIT_QUEUE"."VISIT_DATE" >= :day) and
( "OUTP_WAIT_QUEUE"."REGISTER_DEPT" = :dept_code ) AND ( "OUTP_WAIT_QUEUE"."WORKED_INDICATOR" = :worked_indicator )
:day = '2021/9/26'
:dept_code = '3702'
:worked_indicator = 0
----------------------------------
Timestamp: 09:38:30.978
select sysdate from dual
----------------------------------
Timestamp: 09:38:31.015
select sysdate from dual
----------------------------------
Timestamp: 09:38:31.057
SELECT "CLINIC_MASTER"."VISIT_DATE", "CLINIC_MASTER"."VISIT_NO", "CLINIC_MASTER"."PATIENT_ID", "CLINIC_MASTER"."NAME", 
"CLINIC_MASTER"."IDENTITY", "CLINIC_MASTER"."CHARGE_TYPE", "CLINIC_MASTER"."AGE", "CLINIC_MASTER"."SEX", 
"CLINIC_MASTER"."INSURANCE_TYPE", "CLINIC_MASTER"."CLINIC_TYPE", "DEPT_DICT"."DEPT_NAME", "CLINIC_MASTER"."VISIT_DEPT", 
"CLINIC_MASTER"."SERIAL_NO", "CLINIC_MASTER"."REGISTERING_DATE", "CLINIC_MASTER"."CLINIC_NO", "CLINIC_MASTER"."CLINIC_LABEL", 
'' as "card_no", "OUTPDOCT"."OUTP_WAIT_QUEUE"."DOCTOR" FROM "CLINIC_MASTER", "DEPT_DICT", "OUTPDOCT"."OUTP_WAIT_QUEUE" WHERE ( 
"CLINIC_MASTER"."VISIT_DEPT" = "DEPT_DICT"."DEPT_CODE" (+)) AND ( ( "CLINIC_MASTER"."VISIT_DATE" = :ad_visit_date ) AND ( 
"CLINIC_MASTER"."VISIT_NO" = :ai_visit_no ) ) AND ( "CLINIC_MASTER"."VISIT_DATE" = "OUTPDOCT"."OUTP_WAIT_QUEUE"."VISIT_DATE" ) 
AND ( "CLINIC_MASTER"."VISIT_NO" = "OUTPDOCT"."OUTP_WAIT_QUEUE"."VISIT_NO" )
:ad_visit_date = '2021/11/25'
:ai_visit_no = 954
----------------------------------
Timestamp: 09:38:31.120
SELECT  "PAT_MASTER_INDEX"."PATIENT_ID" ,           "PAT_MASTER_INDEX"."INP_NO" ,           "PAT_MASTER_INDEX"."NAME" ,         
  "PAT_MASTER_INDEX"."SEX" ,           "PAT_MASTER_INDEX"."DATE_OF_BIRTH" ,           "PAT_MASTER_INDEX"."ID_NO" ,           
"PAT_MASTER_INDEX"."IDENTITY" ,           "PAT_MASTER_INDEX"."CHARGE_TYPE" ,           "PAT_MASTER_INDEX"."UNIT_IN_CONTRACT" ,  
         "PAT_MASTER_INDEX"."MAILING_ADDRESS" ,           "PAT_MASTER_INDEX"."PHONE_NUMBER_HOME" ,           
"PAT_MASTER_INDEX"."NEXT_OF_KIN_PHONE"     FROM "PAT_MASTER_INDEX"      WHERE ( "PAT_MASTER_INDEX"."PATIENT_ID" = 
:as_patient_id )
:as_patient_id = 'M0000560'
----------------------------------
Timestamp: 09:38:31.163
select date_of_birth from pat_master_index where patient_id =:1
:1 = 'M0000560'
----------------------------------
Timestamp: 09:38:31.204
select sysdate , round ( months_between ( sysdate , :1 ) , 2 ) from dual
:1 = '2018/1/1'
----------------------------------
Timestamp: 09:38:31.248
select persontype from insurance.insurance_accounts where patient_id =:1
:1 = 'M0000560'
----------------------------------
Timestamp: 09:38:31.282
select count ( *) from official_drug_catalog o where o.charge_type =:1
:1 = '自费'
----------------------------------
Timestamp: 09:38:31.327
select date_of_birth from pat_master_index where patient_id =:1
:1 = 'M0000560'
----------------------------------
Timestamp: 09:38:31.371
select sysdate , round ( months_between ( sysdate , :1 ) , 2 ) from dual
:1 = '2018/1/1'
----------------------------------
Timestamp: 09:38:31.416
SELECT "OUTPDOCT"."PAT_SOMA_CHARACTER"."VISIT_DATE", "OUTPDOCT"."PAT_SOMA_CHARACTER"."VISIT_NO", 
"OUTPDOCT"."PAT_SOMA_CHARACTER"."PATIENT_ID", "OUTPDOCT"."PAT_SOMA_CHARACTER"."EXAM_DATE", 
"OUTPDOCT"."PAT_SOMA_CHARACTER"."WEIGHT", "OUTPDOCT"."PAT_SOMA_CHARACTER"."STATURE", 
"OUTPDOCT"."PAT_SOMA_CHARACTER"."TEMPERATURE", "OUTPDOCT"."PAT_SOMA_CHARACTER"."BLOODPRESSUREL", 
"OUTPDOCT"."PAT_SOMA_CHARACTER"."BLOODPRESSUREH", "OUTPDOCT"."PAT_SOMA_CHARACTER"."PULSE", 
"OUTPDOCT"."PAT_SOMA_CHARACTER"."BREATH_FREQUENCY", 0 "aa", "OUTPDOCT"."PAT_SOMA_CHARACTER"."FONTANELLE_MEASURE", 
"OUTPDOCT"."PAT_SOMA_CHARACTER"."HEAD_CIRCUMFERENCE" FROM "OUTPDOCT"."PAT_SOMA_CHARACTER" WHERE ( 
"OUTPDOCT"."PAT_SOMA_CHARACTER"."VISIT_DATE" = :adt_visit_time ) AND ( "OUTPDOCT"."PAT_SOMA_CHARACTER"."VISIT_NO" = 
:an_visit_no )
:adt_visit_time = '2021/11/25'
:an_visit_no = 954
----------------------------------
Timestamp: 09:38:31.455
select sysdate from dual
----------------------------------
Timestamp: 09:38:31.487
select b.external_code from datamappingdetail b where b.mapping_code ='CHARGETYPE_VS_PRESC' and b.internal_code =:1
:1 = '自费'
----------------------------------
Timestamp: 09:38:31.521
SELECT '0' del_indicator, "OUTP_TREAT_REC"."VISIT_DATE", "OUTP_TREAT_REC"."VISIT_NO", "OUTP_TREAT_REC"."SERIAL_NO", 
"OUTP_TREAT_REC"."ITEM_NO", "OUTP_TREAT_REC"."ITEM_CLASS", "OUTP_TREAT_REC"."ITEM_CODE", "OUTP_TREAT_REC"."ITEM_NAME", 
"OUTP_TREAT_REC"."ITEM_SPEC", "OUTP_TREAT_REC"."UNITS", "OUTP_TREAT_REC"."AMOUNT", "OUTP_TREAT_REC"."FREQUENCY", 
"OUTP_TREAT_REC"."PERFORMED_BY", "OUTP_TREAT_REC"."COSTS", "OUTP_TREAT_REC"."CHARGES", "OUTP_TREAT_REC"."CHARGE_INDICATOR", 
"OUTP_TREAT_REC"."APPOINT_NO", "OUTP_TREAT_REC"."APPOINT_ITEM_NO", "OUTP_TREAT_REC"."FREQ_DETAIL", 
"OUTPDOCT"."OUTP_ORDERS"."DOCTOR_NO" FROM "OUTP_TREAT_REC", "OUTPDOCT"."OUTP_ORDERS" WHERE ( "OUTP_TREAT_REC"."VISIT_DATE" = 
"OUTPDOCT"."OUTP_ORDERS"."VISIT_DATE" ) and ( "OUTP_TREAT_REC"."VISIT_NO" = "OUTPDOCT"."OUTP_ORDERS"."VISIT_NO" ) and ( 
"OUTP_TREAT_REC"."SERIAL_NO" = "OUTPDOCT"."OUTP_ORDERS"."SERIAL_NO" ) and ( "OUTP_TREAT_REC"."VISIT_DATE" = :ad_visit_date ) 
AND ( "OUTP_TREAT_REC"."VISIT_NO" = :ai_visit_no )
:ad_visit_date = '2021/11/25'
:ai_visit_no = 954
----------------------------------
Timestamp: 09:38:31.567
SELECT "OUTP_ORDERS_COSTS"."PATIENT_ID", "OUTP_ORDERS_COSTS"."VISIT_DATE", "OUTP_ORDERS_COSTS"."VISIT_NO", 
"OUTP_ORDERS_COSTS"."SERIAL_NO", "OUTP_ORDERS_COSTS"."ORDER_CLASS", "OUTP_ORDERS_COSTS"."ORDER_NO", 
"OUTP_ORDERS_COSTS"."ORDER_SUB_NO", "OUTP_ORDERS_COSTS"."ITEM_NO", "OUTP_ORDERS_COSTS"."ITEM_CLASS", 
"OUTP_ORDERS_COSTS"."ITEM_NAME", "OUTP_ORDERS_COSTS"."ITEM_CODE", "OUTP_ORDERS_COSTS"."ITEM_SPEC", "OUTP_ORDERS_COSTS"."UNITS", 
"OUTP_ORDERS_COSTS"."REPETITION", "OUTP_ORDERS_COSTS"."AMOUNT", "OUTP_ORDERS_COSTS"."ORDERED_BY_DEPT", 
"OUTP_ORDERS_COSTS"."ORDERED_BY_DOCTOR", "OUTP_ORDERS_COSTS"."PERFORMED_BY", "OUTP_ORDERS_COSTS"."CLASS_ON_RCPT", 
"OUTP_ORDERS_COSTS"."COSTS", "OUTP_ORDERS_COSTS"."CHARGES", "OUTP_ORDERS_COSTS"."RCPT_NO", "OUTP_ORDERS_COSTS"."BILL_DESC_NO", 
"OUTP_ORDERS_COSTS"."BILL_ITEM_NO", "OUTP_ORDERS_COSTS"."CHARGE_INDICATOR", "OUTP_ORDERS_COSTS"."CLASS_ON_RECKONING", 
"OUTP_ORDERS_COSTS"."SUBJ_CODE", "OUTP_ORDERS_COSTS"."PRICE_QUOTIETY", "OUTP_ORDERS_COSTS"."ITEM_PRICE", 
"OUTP_ORDERS_COSTS"."BILL_DATE", "OUTP_ORDERS_COSTS"."BILL_NO", 1, 1.00 as "RELATION_AMOUNT", 1 as "aa", 0 as "presc_no", 0 as 
"dosage", '0' as "dosage_units", '0' as "frequency", '0' as "administration", '0' as "freq_detail" FROM "OUTP_ORDERS_COSTS" 
WHERE ( "OUTP_ORDERS_COSTS"."VISIT_DATE" = :adt_visit_date ) AND ( "OUTP_ORDERS_COSTS"."VISIT_NO" = :ai_visit_no ) AND ( 
"OUTP_ORDERS_COSTS"."ORDER_CLASS" > 'A' or "OUTP_ORDERS_COSTS"."ORDER_CLASS" < 'A' ) AND ( "OUTP_ORDERS_COSTS"."ORDER_CLASS" > 
'B' or "OUTP_ORDERS_COSTS"."ORDER_CLASS" < 'B' )
:adt_visit_date = '2021/11/25'
:ai_visit_no = 954
----------------------------------
Timestamp: 09:38:31.611
SELECT max("OUTP_PRESC"."VISIT_DATE" ) VISIT_DATE, "OUTP_PRESC"."VISIT_NO", "OUTP_PRESC"."SERIAL_NO", "OUTP_PRESC"."PRESC_NO", 
"OUTP_PRESC"."ITEM_CLASS", "OUTP_PRESC"."CHARGE_INDICATOR", "OUTP_PRESC"."DISPENSARY", "CLINIC_MASTER"."PATIENT_ID", 
"OUTP_ORDERS"."YBBZ", "OUTP_PRESC"."PRESC_ATTR" FROM "OUTP_PRESC", "CLINIC_MASTER", "OUTP_ORDERS" WHERE ( 
"OUTP_PRESC"."VISIT_DATE" = "CLINIC_MASTER"."VISIT_DATE" ) and ( "OUTP_PRESC"."VISIT_NO" = "CLINIC_MASTER"."VISIT_NO" ) and ( 
"OUTP_PRESC"."SERIAL_NO" = "OUTP_ORDERS"."SERIAL_NO" ) and ( "CLINIC_MASTER"."VISIT_DATE" = :ad_visit_date ) AND ( 
"CLINIC_MASTER"."VISIT_NO" = :ai_visit_no ) GROUP BY "OUTP_PRESC"."VISIT_NO", "OUTP_PRESC"."SERIAL_NO", "OUTP_PRESC"."PRESC_NO",
 "OUTP_PRESC"."ITEM_CLASS", "OUTP_PRESC"."CHARGE_INDICATOR", "OUTP_PRESC"."DISPENSARY", "CLINIC_MASTER"."PATIENT_ID",
"OUTP_PRESC"."PRESC_ATTR" ,
"OUTP_ORDERS"."YBBZ"
:ad_visit_date = '2021/11/25'
:ai_visit_no = 954
----------------------------------
Timestamp: 09:38:31.655
SELECT  "OUTP_ORDERS_COSTS"."VISIT_DATE" ,           "OUTP_ORDERS_COSTS"."VISIT_NO" ,           "OUTP_ORDERS_COSTS"."SERIAL_NO" 
,           "OUTP_ORDERS_COSTS"."ORDER_NO" ,           "OUTP_ORDERS_COSTS"."ORDER_SUB_NO" ,           
"OUTP_ORDERS_COSTS"."COSTS" ,           "OUTP_ORDERS_COSTS"."CHARGES" ,           "OUTP_ORDERS_COSTS"."CHARGE_INDICATOR"     
FROM "OUTP_ORDERS_COSTS"      WHERE ( "OUTP_ORDERS_COSTS"."VISIT_DATE" = :adt_visit_date ) and          ( 
"OUTP_ORDERS_COSTS"."VISIT_NO" = :ai_visit_no ) and          (( "OUTP_ORDERS_COSTS"."ORDER_CLASS" = 'A' ) or          ( 
"OUTP_ORDERS_COSTS"."ORDER_CLASS" = 'B' ))
:adt_visit_date = '2021/11/25'
:ai_visit_no = 954
----------------------------------
Timestamp: 09:38:31.696
SELECT max("OUTP_PRESC"."VISIT_DATE" ) VISIT_DATE, "OUTP_PRESC"."VISIT_NO", "OUTP_PRESC"."SERIAL_NO", "OUTP_PRESC"."PRESC_NO", 
"OUTP_PRESC"."ITEM_CLASS", "OUTP_PRESC"."CHARGE_INDICATOR", "OUTP_PRESC"."DISPENSARY", "CLINIC_MASTER"."PATIENT_ID", 
"OUTP_ORDERS"."YBBZ", "OUTP_PRESC"."PRESC_ATTR" FROM "OUTP_PRESC", "CLINIC_MASTER", "OUTP_ORDERS" WHERE ( 
"OUTP_PRESC"."VISIT_DATE" = "CLINIC_MASTER"."VISIT_DATE" ) and ( "OUTP_PRESC"."VISIT_NO" = "CLINIC_MASTER"."VISIT_NO" ) and ( 
"OUTP_PRESC"."SERIAL_NO" = "OUTP_ORDERS"."SERIAL_NO" ) and ( "CLINIC_MASTER"."VISIT_DATE" = :ad_visit_date ) AND ( 
"CLINIC_MASTER"."VISIT_NO" = :ai_visit_no ) GROUP BY "OUTP_PRESC"."VISIT_NO", "OUTP_PRESC"."SERIAL_NO", "OUTP_PRESC"."PRESC_NO",
 "OUTP_PRESC"."ITEM_CLASS", "OUTP_PRESC"."CHARGE_INDICATOR", "OUTP_PRESC"."DISPENSARY", "CLINIC_MASTER"."PATIENT_ID",
"OUTP_PRESC"."PRESC_ATTR" ,
"OUTP_ORDERS"."YBBZ"
:ad_visit_date = '2021/11/25'
:ai_visit_no = 954
----------------------------------
Timestamp: 09:38:31.741
select max ( order_no ) from OUTP_PRESC where visit_date =:1 and visit_no =:2
:1 = '2021/11/25'
:2 = 954
----------------------------------
Timestamp: 09:38:31.793
SELECT "OUTP_MR"."PATIENT_ID", "OUTP_MR"."VISIT_DATE", "OUTP_MR"."VISIT_NO", "OUTP_MR"."ILLNESS_DESC", "OUTP_MR"."ANAMNESIS", 
"OUTP_MR"."FAMILY_ILL", "OUTP_MR"."MARRITAL", "OUTP_MR"."INDIVIDUAL", "OUTP_MR"."MENSES", "OUTP_MR"."MED_HISTORY", 
"OUTP_MR"."BODY_EXAM", "OUTP_MR"."DIAG_DESC", "OUTP_MR"."ADVICE", "OUTP_MR"."DOCTOR", "OUTP_MR"."ORDINAL", 
"OUTP_MR"."OPERATION_RECORD", "OUTP_MR"."MEDICAL_RECORD", "OUTP_MR"."DOCTOR_NO", "OUTP_MR"."TOOTH", "OUTP_MR"."MEMO", 
"OUTP_MR"."CDIAG", "OUTP_MR"."ILLNESS_DATE", "OUTP_MR"."MATERNITY",
"OUTP_MR".flag_birth,flag_infect
FROM "OUTP_MR" WHERE ( "OUTP_MR"."VISIT_DATE" = :ad_visit_date ) AND ( "OUTP_MR"."VISIT_NO" = :ai_visit_no ) AND ( 
"OUTP_MR"."DOCTOR_NO" = :as_doctor )
:ad_visit_date = '2021/11/25'
:ai_visit_no = 954
:as_doctor = 'FYADMIN'
----------------------------------
Timestamp: 09:38:31.931
SELECT "CLINIC_MASTER"."VISIT_DATE", "CLINIC_MASTER"."VISIT_NO", "CLINIC_MASTER"."PATIENT_ID", "CLINIC_MASTER"."NAME", 
"CLINIC_MASTER"."IDENTITY", "CLINIC_MASTER"."CHARGE_TYPE", "CLINIC_MASTER"."AGE", "CLINIC_MASTER"."SEX", 
"CLINIC_MASTER"."INSURANCE_TYPE", "CLINIC_MASTER"."CLINIC_TYPE", "CLINIC_MASTER"."VISIT_DEPT", "CLINIC_MASTER"."SERIAL_NO", 
"CLINIC_MASTER"."REGISTERING_DATE", "CLINIC_MASTER"."CLINIC_NO", "CLINIC_MASTER"."DOCTOR", decode("COMM"."STAFF_DICT"."NAME", 
null, "CLINIC_MASTER"."DOCTOR", "COMM"."STAFF_DICT"."NAME") as "doctor_name" FROM "CLINIC_MASTER", "COMM"."STAFF_DICT" WHERE ( 
"CLINIC_MASTER"."DOCTOR" = "COMM"."STAFF_DICT"."USER_NAME"(+) ) and ( ( "CLINIC_MASTER"."VISIT_DATE" >= :adt_visit_date ) AND ( 
"CLINIC_MASTER"."PATIENT_ID" = :as_patient_id ) AND "CLINIC_MASTER"."RETURNED_DATE" is null )
:adt_visit_date = '2021/5/29'
:as_patient_id = 'M0000560'
----------------------------------
Timestamp: 09:38:32.072
SELECT DISTINCT "EXAM"."EXAM_APPOINTS"."EXAM_CLASS", "EXAM"."EXAM_APPOINTS"."EXAM_SUB_CLASS", 
"EXAM"."EXAM_APPOINTS"."REQ_DATE_TIME", "EXAM"."EXAM_APPOINTS"."SCHEDULED_DATE", "EXAM"."EXAM_APPOINTS"."REQ_PHYSICIAN", 
"EXAM"."EXAM_APPOINTS"."REQ_DEPT", "EXAM"."EXAM_APPOINTS"."NOTICE", "EXAM"."EXAM_APPOINTS"."EXAM_NO", 
"EXAM"."EXAM_APPOINTS"."CLIN_SYMP", "EXAM"."EXAM_APPOINTS"."PHYS_SIGN", "EXAM"."EXAM_APPOINTS"."RELEVANT_LAB_TEST", 
"EXAM"."EXAM_APPOINTS"."RELEVANT_DIAG", "EXAM"."EXAM_APPOINTS"."CLIN_DIAG", "EXAM"."EXAM_APPOINTS"."PERFORMED_BY", 
"EXAM"."EXAM_APPOINTS"."DOCTOR_USER", "MEDREC"."PAT_MASTER_INDEX"."NAME",
"MEDREC"."PAT_MASTER_INDEX"."SEX" FROM "EXAM"."EXAM_APPOINTS", "MEDREC"."PAT_MASTER_INDEX" WHERE ( 
"EXAM"."EXAM_APPOINTS"."PATIENT_ID" = "MEDREC"."PAT_MASTER_INDEX"."PATIENT_ID" ) and ( "EXAM"."EXAM_APPOINTS"."SCHEDULED_DATE" 
>= sysdate - 1 OR "EXAM"."EXAM_APPOINTS"."SCHEDULED_DATE" is null) AND "EXAM"."EXAM_APPOINTS"."PATIENT_ID" = :as_patient_id AND 
( "EXAM"."EXAM_APPOINTS"."VISIT_ID" is null OR
"EXAM"."EXAM_APPOINTS"."VISIT_ID" = 0)
:as_patient_id = 'M0000560'
----------------------------------
Timestamp: 09:38:32.142
SELECT "LAB_TEST_MASTER"."TEST_NO", "LAB_TEST_MASTER"."TEST_CAUSE", "LAB_TEST_MASTER"."SPECIMEN", 
"LAB_TEST_MASTER"."REQUESTED_DATE_TIME", "LAB_TEST_MASTER"."ORDERING_PROVIDER", "LAB_TEST_MASTER"."RESULT_STATUS", 
"LAB_TEST_MASTER"."BILLING_INDICATOR", "LAB_TEST_MASTER"."RESULTS_RPT_DATE_TIME", "LAB_TEST_MASTER"."TRANSCRIPTIONIST", 
"LAB_TEST_MASTER"."ORDERING_DEPT", "LAB_TEST_ITEMS"."ITEM_NO", "LAB_TEST_ITEMS"."ITEM_NAME" FROM "LAB_TEST_MASTER", 
"LAB_TEST_ITEMS" WHERE ( "LAB_TEST_MASTER"."TEST_NO" = "LAB_TEST_ITEMS"."TEST_NO" ) and ( "LAB_TEST_MASTER"."PATIENT_ID" = 
:as_patient_id )
:as_patient_id = 'M0000560'
----------------------------------
Timestamp: 09:38:32.178
SELECT '0' as "del_indicator",
'普通药品' as "toxi_property",
'' as "official_catalog",
"OUTP_PRESC"."VISIT_DATE",
"OUTP_PRESC"."VISIT_NO",
"OUTP_PRESC"."SERIAL_NO",
"OUTP_PRESC"."PRESC_NO",
"OUTP_PRESC"."ITEM_NO",
"OUTP_PRESC"."ITEM_CLASS",
"OUTP_PRESC"."DRUG_CODE",
"OUTP_PRESC"."DRUG_NAME",
"OUTP_PRESC"."DRUG_SPEC",
"OUTP_PRESC"."FIRM_ID",
"OUTP_PRESC"."UNITS",
"OUTP_PRESC"."AMOUNT",
"OUTP_PRESC"."DOSAGE",
"OUTP_PRESC"."DOSAGE_UNITS",
"OUTP_PRESC"."ADMINISTRATION",
"OUTP_PRESC"."FREQUENCY",
"OUTP_PRESC"."PROVIDED_INDICATOR",
"OUTP_PRESC"."COSTS",
"OUTP_PRESC"."CHARGES",
"OUTP_PRESC"."CHARGE_INDICATOR",
"OUTP_PRESC"."DISPENSARY",
"OUTP_PRESC"."REPETITION",
"OUTP_PRESC"."ORDER_NO",
"OUTP_PRESC"."SUB_ORDER_NO",
"OUTP_PRESC"."FREQ_DETAIL",
"OUTP_PRESC"."GETDRUG_FLAG",
"OUTP_PRESC"."PRESC_ATTR",
"OUTP_PRESC"."ABIDANCE",
"OUTP_PRESC"."SKIN_RESULT",
"OUTP_PRESC"."SKIN_FLAG"
FROM "OUTP_PRESC", "CLINIC_MASTER"
WHERE ("OUTP_PRESC"."VISIT_DATE" = "CLINIC_MASTER"."VISIT_DATE")
and ("OUTP_PRESC"."VISIT_NO" = "CLINIC_MASTER"."VISIT_NO")
and ("CLINIC_MASTER"."PATIENT_ID" = :as_patient_id)
and ("CLINIC_MASTER"."VISIT_DATE" >= sysdate - 180)
/*  and ("CLINIC_MASTER"."VISIT_DATE" = :ad_visit_date)
   AND ("CLINIC_MASTER"."VISIT_NO" = :ai_visit_no)  */
:as_patient_id = 'M0000560'
----------------------------------
Timestamp: 09:38:32.274
SELECT "OUTP_TREAT_REC"."VISIT_DATE",
"OUTP_TREAT_REC"."SERIAL_NO",
"OUTP_TREAT_REC"."ITEM_NO",
"OUTP_TREAT_REC"."ITEM_CLASS",
"OUTP_TREAT_REC"."ITEM_CODE",
"OUTP_TREAT_REC"."ITEM_NAME",
"OUTP_TREAT_REC"."UNITS",
"OUTP_TREAT_REC"."AMOUNT",
"OUTP_TREAT_REC"."PERFORMED_BY",
"OUTP_TREAT_REC"."COSTS",
"OUTP_TREAT_REC"."CHARGES",
"OUTP_TREAT_REC"."CHARGE_INDICATOR",
"OUTP_TREAT_REC"."VISIT_NO",
'0' del_indicator,
"OUTP_TREAT_REC"."FREQUENCY",
"OUTP_TREAT_REC"."ITEM_SPEC",
"OUTP_TREAT_REC"."APPOINT_NO",
"OUTP_TREAT_REC"."APPOINT_ITEM_NO",
"OUTP_TREAT_REC"."FREQ_DETAIL"
FROM "OUTP_TREAT_REC", "CLINIC_MASTER"
WHERE ("OUTP_TREAT_REC"."VISIT_NO" = "CLINIC_MASTER"."VISIT_NO")
and ("OUTP_TREAT_REC"."VISIT_DATE" = "CLINIC_MASTER"."VISIT_DATE")
and ("CLINIC_MASTER"."PATIENT_ID" = :as_patient_id)
and ("CLINIC_MASTER"."VISIT_DATE" >= sysdate - 180)
/*  and ("CLINIC_MASTER"."VISIT_DATE" = :ad_visit_date)
   AND ("CLINIC_MASTER"."VISIT_NO" = :ai_visit_no)   */
:as_patient_id = 'M0000560'
----------------------------------
Timestamp: 09:38:32.344
SELECT "OUTP_CONSULTATION_MASTER"."VISIT_DATE", "OUTP_CONSULTATION_MASTER"."VISIT_NO",
"OUTP_CONSULTATION_MASTER"."PATIENT_ID" ,
"OUTP_CONSULTATION_MASTER"."CONSULTATION_ID", "OUTP_CONSULTATION_MASTER"."END_DATE_TIME",
"OUTP_CONSULTATION_MASTER"."CONSULTATION_APPLY_DOCTOR"
FROM "OUTP_CONSULTATION_MASTER" WHERE "OUTP_CONSULTATION_MASTER"."VISIT_DATE" = :as_visit_date and 
"OUTP_CONSULTATION_MASTER"."VISIT_NO" = :as_visit_no
:as_visit_date = '2021/11/25'
:as_visit_no = 954
----------------------------------
Timestamp: 09:38:32.506
select date_of_birth from pat_master_index where patient_id =:1
:1 = 'M0000560'
----------------------------------
Timestamp: 09:38:32.548
select sysdate , round ( months_between ( sysdate , :1 ) , 2 ) from dual
:1 = '2018/1/1'
```

![image-20211125100801025](C:\Users\11839\AppData\Roaming\Typora\typora-user-images\image-20211125100801025.png)



![image-20211125100906668](C:\Users\11839\AppData\Roaming\Typora\typora-user-images\image-20211125100906668.png)

## 业务中涉及到的一些表（部分）

CLINIC_FOR_REGIST

![image-20211125104216534](C:\Users\11839\AppData\Roaming\Typora\typora-user-images\image-20211125104216534.png)

AREA_TO_DICT

area_to_dict

clinic_master

unit_in_contract

pat_master_index

##### 1.1 病人主索引 PAT_MASTER_INDEX

| 字段中文名称     | 字段名                | 类型     | 长度 | 说明                                                         |
| ---------------- | --------------------- | -------- | ---- | ------------------------------------------------------------ |
| 病人标识号       | PATIENT_ID            | C        | 10   | 病人唯一标识号，可以由用户赋予具体的含义，如：病案号，门诊号等 |
| 住院号           | INP_NO                | C        | 10   | 可选的病人标识，可为空                                       |
| 姓名             | NAME                  | C        | 20   | 病人姓名                                                     |
| 姓名拼音         | NAME_PHONETIC         | C        | 16   | 病人姓名拼音，大写，字间用一个空格分隔，超长截断             |
| 性别             | SEX                   | C        | 4    | 男、女、未知，本系统定义，见性别字典                         |
| 出生日期         | DATE_OF_BIRTH         | D        |      |                                                              |
| 出生地           | BIRTH_PLACE           | C        | 6    | 指定省市县，使用代码，见行政区字典                           |
| 国籍             | CITIZENSHIP           | C        | 2    | 使用国家代码，见国家及地区字典                               |
| 民族             | NATION                | C        | 10   | 民族规范名称，见民族字典                                     |
| 身份证号         | ID_NO                 | C        | 18   |                                                              |
| 身份             | IDENTITY              | C        | 10   | 由身份登记子系统生成，住院登记子系统在办理入院时更新。使用规范名称，由用户定义，见身份字典 |
| 费别             | CHARGE_TYPE           | C        | 8    | 由身份登记子系统生成，住院登记子系统在办理入院时更新。使用规范名称，由用户定义，见费别字典 |
| 合同单位         | UNIT_IN_CONTRACT      | C        | 11   | 如果病人所在单位为本医院的合同单位或体系单位，则使用代码，否则为空。由身份登记子系统生成，住院登记子系统在办理入院时更新。代码由用户定义，见合同单位记录 |
| 通信地址         | MAILING_ADDRESS       | C        | 40   | 指永久通信地址                                               |
| 邮政编码         | ZIP_CODE              | C        | 6    | 对应通信地址的邮政编码                                       |
| 家庭电话号码     | PHONE_NUMBER_HOME     | C        | 16   |                                                              |
| 单位电话号码     | PHONE_NUMBER_BUSINESS | C        | 16   |                                                              |
| 联系人姓名       | NEXT_OF_KIN           | C        | 8    | 病人的亲属姓名                                               |
| 与联系人关系     | RELATIONSHIP          | C        | 2    | 夫妻、父子等，使用代码，见社会关系字典                       |
| 联系人地址       | NEXT_OF_KIN_ADDR      | C        | 40   |                                                              |
| 联系人邮政编码   | NEXT_OF_KIN_ZIP_CODE  | C        | 6    |                                                              |
| 联系人电话号码   | NEXT_OF_KIN_PHONE     | C        | 16   |                                                              |
| 上次就诊日期     | LAST_VISIT_DATE       | D        | 7    | 由挂号与预约子系统根据就诊记录填写                           |
| 重要人物标志     | VIP_INDICATOR         | N        | 1    | 1-VIP 0-非VIP                                                |
| 建卡日期         | CREATE_DATE           | D        | 7    |                                                              |
| 操作员           | OPERATOR              | C        | 8    | 最后修改本记录的操作员姓名                                   |
| 医疗体系病人标志 | SERVICE_AGENCY        | C        | 40   |                                                              |
| 单位邮编         | business_zip_code     | C        | 6    |                                                              |
| 照片             | photo                 | Long raw |      |                                                              |
| 入院来源         | PATIENT_CLASS         | C        |      | 使用代码，门诊、急诊、转入等，见入院方式字典                 |
| 学历             | degree                | C        | 10   | 见学历字典                                                   |
| 种族             | race                  | C        | 10   | 见种族字典                                                   |
| 宗教             | religion              | C        | 16   | 见宗教字典                                                   |
| 母语             | Mother_language       | C        | 16   | 见语言字典                                                   |
| 第二外语         | Foreign_language      | C        | 16   | 所能接受的服务语言,见语言字典                                |
| 证件类型         | ID_type               | C        | 10   | 见证件类型字典                                               |
| 会员号           | Vip_no                | C        | 18   |                                                              |
| 英文名字         | e_name                | var      | 100  | 住院登记、身份登记、主索引录入时增加英文名字。               |

 

 

注释：此表描述所有在院注册的病人的基本信息，被整个医院信息系统所共享。由身份登记子系统录入。

此表信息需长期在线保存，如果使用挂号子系统，则此表的数据增长量与每日的初诊病人数相一致。如果医院每日门诊量为1000，其中1/4为初诊病人，则每日数据增长量约为250条，每年约为80,000条。

主键：病人标识号。

## 二、数据窗口操作步骤

### 1 步骤



1 新建-->datawindow -->grid 再选择SQL Select (弹出的select tables叉掉)

2 菜单栏选择 Design 的 Conver to SynTax,输入对应的sql语句。例如。这里不用吧保存

```sql
select * from GOODS_SALES_IN where (id=:id or id is null)
```

3 再在菜单栏选择Design 的 Retrieval Arguments 

![杨-任务1](I:\Symedsoft\研发部\杨-任务1.png)

```sql
3 select * from GOODS_BUY_IN where (id=:id or id is null)

4 select * from GOODS_PURC_BACK_IN where (id=:id or id is null)

5 select * from GOODS_SALES_IN where (id=:id or id is null)
6 select * from GOODS_SALES_BACK_IN where (id=:id or id is null)
```

4 return

### 2 注意点

use delete then insert

use update

先删除在插入，注意选择更新列，建议全部选择上，再删除，否则会导致更新时，未选择的字段为空